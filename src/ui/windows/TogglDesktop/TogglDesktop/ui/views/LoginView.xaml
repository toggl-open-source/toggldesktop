<UserControl x:Class="TogglDesktop.LoginView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:toggl="clr-namespace:TogglDesktop"
             xmlns:viewModels="clr-namespace:TogglDesktop.ViewModels"
             xmlns:converters="clr-namespace:TogglDesktop.Converters"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:behaviours="http://metro.mahapps.com/winfx/xaml/shared"
             xmlns:behaviors="clr-namespace:TogglDesktop.Behaviors"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             mc:Ignorable="d" 
             MinHeight="456" MinWidth="300"
             Background="{DynamicResource Toggl.CardBackground}"
             d:DataContext="{d:DesignInstance viewModels:LoginViewModel, IsDesignTimeCreatable=False}">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Resources/DesignUpdate/Controls.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <!-- ReSharper disable once Xaml.RedundantResource -->
            <Storyboard x:Key="RotateConfirmSpinner" BeginTime="00:00:00.000"
                        Duration="00:00:1.000" RepeatBehavior="Forever">
                <DoubleAnimation Storyboard.TargetName="confirmButtonSpinner"
                Storyboard.TargetProperty="(FrameworkElement.LayoutTransform).(RotateTransform.Angle)" 
                From="0" To="360" BeginTime="00:00:00.000" Duration="00:00:01.000"/>
            </Storyboard>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
            <converters:EqualToVisibilityConverter x:Key="ShowOnLogIn">
                <converters:EqualToVisibilityConverter.ExpectedValue>
                    <viewModels:ConfirmAction>LogIn</viewModels:ConfirmAction>
                </converters:EqualToVisibilityConverter.ExpectedValue>
            </converters:EqualToVisibilityConverter>
            <converters:EqualToVisibilityConverter x:Key="ShowOnSignUp">
                <converters:EqualToVisibilityConverter.ExpectedValue>
                    <viewModels:ConfirmAction>SignUp</viewModels:ConfirmAction>
                </converters:EqualToVisibilityConverter.ExpectedValue>
            </converters:EqualToVisibilityConverter>
        </ResourceDictionary>
    </UserControl.Resources>
    <UserControl.InputBindings>
        <KeyBinding Key="Enter" Command="{Binding ConfirmLoginSignupCommand}" />
    </UserControl.InputBindings>
    <Grid Background="{StaticResource ViewBackground}">
        <Border BorderThickness="1" BorderBrush="{DynamicResource Toggl.LoginView.Border}"
            Width="300" Height="460"
            Background="{DynamicResource Toggl.CardBackground}"
            VerticalAlignment="Center" HorizontalAlignment="Center">
            <DockPanel>
                <Image Source="{DynamicResource Toggl.LogoImage}"
                       DockPanel.Dock="Top"
                       Margin="0 50 0 0"
                       SnapsToDevicePixels="True"
                       Stretch="None" />
                <StackPanel Orientation="Vertical"
                            DockPanel.Dock="Bottom"
                            Margin="0 44 0 0">
                    <TextBlock Text="Don't have an account?"
                               Style="{DynamicResource Toggl.CaptionBlackText}"
                               HorizontalAlignment="Center"
                               Visibility="{Binding SelectedConfirmAction, Converter={StaticResource ShowOnLogIn}}"/>

                    <Label HorizontalAlignment="Center"
                           Margin="0 1 0 24">
                        <Hyperlink Style="{StaticResource Toggl.NormalHyperlink}"
                                   Click="onSignupLoginToggleClick">
                            <Hyperlink.Inlines>
                                <Run Text="{Binding SignupLoginToggleText, Mode=OneWay}" />
                            </Hyperlink.Inlines>
                        </Hyperlink>
                    </Label>
                </StackPanel>
                <StackPanel IsEnabled="{Binding IsViewEnabled}">
                    <TextBox x:Name="emailTextBox" x:FieldModifier="private"
                             Margin="0 20 0 0"
                             Width="200"
                             mah:TextBoxHelper.Watermark="Email address"
                             Text="{Binding Email, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True, NotifyOnValidationError=True}"
                             behaviors:FocusHelper.IsFocused="{Binding IsEmailFocused}"/>
                    <PasswordBox x:Name="passwordBox" x:FieldModifier="private"
                                 PasswordChar="*"
                                 Margin="0 8 0 0"
                                 Width="200"
                                 mah:TextBoxHelper.Watermark="Password"
                                 behaviours:PasswordBoxBindingBehavior.Password="{Binding Password, ValidatesOnDataErrors=True, NotifyOnValidationError=True}"
                                 behaviors:FocusHelper.IsFocused="{Binding IsPasswordFocused}"/>

                    <Label HorizontalAlignment="Left"
                           Margin="48 12 0 0"
                           Visibility="{Binding SelectedConfirmAction, Converter={StaticResource ShowOnLogIn}}">
                        <Hyperlink Style="{StaticResource Toggl.NormalHyperlink}"
                                   Click="onForgotPasswordLinkClick">Forgot password?</Hyperlink>
                    </Label>

                    <ComboBox Name="countryComboBox"
                              Margin="0 8 0 0"
                              Width="200"
                              Height="32"
                              ItemsSource="{Binding Countries}"
                              SelectedItem="{Binding SelectedCountry, ValidatesOnDataErrors=True, NotifyOnValidationError=True}"
                              Visibility="{Binding SelectedConfirmAction, Converter={StaticResource ShowOnSignUp}}"
                              SelectedValuePath="Name"
                              DisplayMemberPath="Name"
                              VerticalAlignment="Center"
                              VerticalContentAlignment="Center"
                              IsTextSearchEnabled="True"
                              IsTextSearchCaseSensitive="False"
                              TextSearch.TextPath="Name"
                              mah:TextBoxHelper.Watermark="Select country"
                              behaviors:FocusHelper.IsFocused="{Binding IsCountrySelectionFocused}"/>
                    <CheckBox Name="tosCheckBox" Margin="50 16 0 0"
                              HorizontalAlignment="Left"
                              Visibility="{Binding SelectedConfirmAction, Converter={StaticResource ShowOnSignUp}}"
                              IsChecked="{Binding IsTosChecked, ValidatesOnDataErrors=True, NotifyOnValidationError=True}"
                              behaviors:FocusHelper.IsFocused="{Binding IsTosCheckboxFocused}">
                        <WrapPanel Margin="8 -8 0 0" HorizontalAlignment="Left">
                            <TextBlock Style="{DynamicResource Toggl.CaptionText}">
                                I agree to
                                <Hyperlink
                                    NavigateUri="https://toggl.com/legal/terms"
                                    RequestNavigate="Hyperlink_RequestNavigate"
                                    Style="{StaticResource Toggl.NormalHyperlink}">
                                    Terms of Service
                                </Hyperlink>
                                <LineBreak/> and
                                <Hyperlink
                                    NavigateUri="https://toggl.com/legal/privacy"
                                    RequestNavigate="Hyperlink_RequestNavigate"
                                    Style="{StaticResource Toggl.NormalHyperlink}">
                                    Privacy Policy
                                </Hyperlink>
                            </TextBlock>
                        </WrapPanel>
                    </CheckBox>

                    <Grid Margin="0 20 0 0" Height="32" Width="200">
                        <Border Background="{DynamicResource Toggl.SecondaryAccentBrush}"
                                Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <Image Source="/TogglDesktop;component/Resources/login-spinner.png"
                                   Name="confirmButtonSpinner" x:FieldModifier="private"
                                   Stretch="Fill" Width="24" Height="24"
                                   VerticalAlignment="Center" HorizontalAlignment="Center"
                                   Opacity="0.6"
                                   UseLayoutRounding="False">
                                <Image.LayoutTransform>
                                    <RotateTransform Angle="00"/>
                                </Image.LayoutTransform>
                            </Image>
                        </Border>
                        <Button Style="{StaticResource Toggl.SecondaryAccentButton}"
                                Command="{Binding ConfirmLoginSignupCommand}"
                                Content="{Binding ConfirmButtonText}"
                                Visibility="{Binding IsViewEnabled, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </Grid>

                    <Button Margin="0 10 0 0"
                            Width="200"
                            Command="{Binding ConfirmGoogleLoginSignupCommand}"
                            Style="{StaticResource Toggl.OutlinedButton}">
                        <StackPanel Orientation="Horizontal">
                            <Image Source="/TogglDesktop;component/Resources/icon-google.png"
                                   Width="14" Height="14" Margin="0 0 8 0" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding GoogleLoginButtonText}"
                                       Style="{StaticResource Toggl.BodyText}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </DockPanel>
        </Border>
    </Grid>
</UserControl>
